<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä | Manas Mahale</title><meta name=keywords content="Rust,Brainf**k"><meta name=description content="History Brainf**k hereafter referred to as BF, is a turing complete, esoteric programming language created by Urban M√ºller. For the uninitiated, esoteric languages are programming languages that are designed specifically to be unique, difficult to program in, or be just plain weird.
Crash Course in BF OpCode Instruction > Increment the data pointer < Decrement the data pointer [ If the byte at the data pointer is zero, jump instruction pointer forward to the command after the matching ] command ] If the byte at the data pointer is nonzero, move instruction pointer to the command after the matching [ command , One byte Input at the data pointer ."><meta name=author content="Manas Mahale"><link rel=canonical href=https://manasmahale.xyz/posts/rust-3/><link crossorigin=anonymous href=/assets/css/stylesheet.d7fb4cbf980fe688a21621b06a795933c4e6bb2d4070ec940667af1715d84af2.css integrity="sha256-1/tMv5gP5oiiFiGwanlZM8Tmuy1AcOyUBmevFxXYSvI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://cdn.rcsb.org/images/structures/vx/6vxx/6vxx_assembly-1.jpeg><link rel=icon type=image/png sizes=16x16 href=https://cdn.rcsb.org/images/structures/vx/6vxx/6vxx_assembly-1.jpeg><link rel=icon type=image/png sizes=32x32 href=https://cdn.rcsb.org/images/structures/vx/6vxx/6vxx_assembly-1.jpeg><link rel=apple-touch-icon href=https://cdn.rcsb.org/images/structures/vx/6vxx/6vxx_assembly-1.jpeg><link rel=mask-icon href=https://cdn.rcsb.org/images/structures/vx/6vxx/6vxx_assembly-1.jpeg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-220330184-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä"><meta property="og:description" content="History Brainf**k hereafter referred to as BF, is a turing complete, esoteric programming language created by Urban M√ºller. For the uninitiated, esoteric languages are programming languages that are designed specifically to be unique, difficult to program in, or be just plain weird.
Crash Course in BF OpCode Instruction > Increment the data pointer < Decrement the data pointer [ If the byte at the data pointer is zero, jump instruction pointer forward to the command after the matching ] command ] If the byte at the data pointer is nonzero, move instruction pointer to the command after the matching [ command , One byte Input at the data pointer ."><meta property="og:type" content="article"><meta property="og:url" content="https://manasmahale.xyz/posts/rust-3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-21T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-21T00:00:00+00:00"><meta property="og:site_name" content="Manas Mahale"><meta name=twitter:card content="summary"><meta name=twitter:title content="ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä"><meta name=twitter:description content="History Brainf**k hereafter referred to as BF, is a turing complete, esoteric programming language created by Urban M√ºller. For the uninitiated, esoteric languages are programming languages that are designed specifically to be unique, difficult to program in, or be just plain weird.
Crash Course in BF OpCode Instruction > Increment the data pointer < Decrement the data pointer [ If the byte at the data pointer is zero, jump instruction pointer forward to the command after the matching ] command ] If the byte at the data pointer is nonzero, move instruction pointer to the command after the matching [ command , One byte Input at the data pointer ."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://manasmahale.xyz/posts/"},{"@type":"ListItem","position":3,"name":"ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä","item":"https://manasmahale.xyz/posts/rust-3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä","name":"ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä","description":"History Brainf**k hereafter referred to as BF, is a turing complete, esoteric programming language created by Urban M√ºller. For the uninitiated, esoteric languages are programming languages that are designed specifically to be unique, difficult to program in, or be just plain weird.\nCrash Course in BF OpCode Instruction \u0026gt; Increment the data pointer \u0026lt; Decrement the data pointer [ If the byte at the data pointer is zero, jump instruction pointer forward to the command after the matching ] command ] If the byte at the data pointer is nonzero, move instruction pointer to the command after the matching [ command , One byte Input at the data pointer .","keywords":["Rust","Brainf**k"],"articleBody":" History Brainf**k hereafter referred to as BF, is a turing complete, esoteric programming language created by Urban M√ºller. For the uninitiated, esoteric languages are programming languages that are designed specifically to be unique, difficult to program in, or be just plain weird.\nCrash Course in BF OpCode Instruction \u003e Increment the data pointer \u003c Decrement the data pointer [ If the byte at the data pointer is zero, jump instruction pointer forward to the command after the matching ] command ] If the byte at the data pointer is nonzero, move instruction pointer to the command after the matching [ command , One byte Input at the data pointer . Output the byte at the data pointer + Increment the byte at the data pointer - Decrement the byte at the data pointer This is how we can print Hello World! in BF.\n1 ++++++++[\u003e++++[\u003e++\u003e+++\u003e+++\u003e+\u003c\u003c\u003c\u003c-]\u003e+\u003e+\u003e-\u003e\u003e+[\u003c]\u003c-]\u003e\u003e.\u003e---.+++++++..+++.\u003e\u003e.\u003c-.\u003c.+++.------.--------.\u003e\u003e+.\u003e++. Interpreter Creating an interpreter for any common programming language is a difficult task but, BF having only 8 commands makes interpreter much easier. We can break down the task of writing a BF interpreter into 3 tasks.\n1Ô∏è‚É£ Lexer 2Ô∏è‚É£ Parser 3Ô∏è‚É£ Interpreter\n0Ô∏è‚É£ Imports 1 2 3 4 5 use std::{env, io::Read, fs::File}; // Or // use std::env; // use std::io::Read; // use std::fs::File; 1Ô∏è‚É£ Lexer This is a relatively straightforward task. As we know, there are 8 commands in BF which we can represent as Enum.\n1 2 3 4 5 6 7 8 9 10 11 #[derive(Clone, Debug)] enum OpCode { IncrementPointer, // \u003e DecrementPointer, // \u003c Increment, // + Decrement, // - Write, // . Read, // , LoopBegin, // [ LoopEnd, // ] } Let‚Äôs write the Lexer as function using the defined OpCode. Lexer takes in a String and returns a Vector of OpCode. I‚Äôve considered all the characters other than OpCode to be comments for simplicity.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 fn lex(source: String) -\u003e Vec\u003cOpCode\u003e { let mut operations = Vec::new(); for symbol in source.chars() { let op = match symbol { '\u003e' =\u003e Some(OpCode::IncrementPointer), '\u003c' =\u003e Some(OpCode::DecrementPointer), '+' =\u003e Some(OpCode::Increment), '-' =\u003e Some(OpCode::Decrement), '.' =\u003e Some(OpCode::Write), ',' =\u003e Some(OpCode::Read), '[' =\u003e Some(OpCode::LoopBegin), ']' =\u003e Some(OpCode::LoopEnd), _ =\u003e None }; // Removing Comments. match op { Some(op) =\u003e operations.push(op), None =\u003e () } } operations } 2Ô∏è‚É£ Parser From the table above, we can associate the OpCode with their respective Instruction. We can represent Instruction as Enum.\n1 2 3 4 5 6 7 8 9 10 #[derive(Debug, Clone)] enum Instruction { IncrementPointer, DecrementPointer, Increment, Decrement, Write, Read, Loop(Vec\u003cInstruction\u003e) } Parser takes in the Vector of OpCode generated by the lexer and returns Vector of Instruction.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 fn parse(opcodes: Vec\u003cOpCode\u003e) -\u003e Vec\u003cInstruction\u003e { let mut program: Vec\u003cInstruction\u003e = Vec::new(); let mut loop_stack = 0; let mut loop_start = 0; for (i, op) in opcodes.iter().enumerate() { if loop_stack == 0 { let instr = match op { OpCode::IncrementPointer =\u003e Some(Instruction::IncrementPointer), OpCode::DecrementPointer =\u003e Some(Instruction::DecrementPointer), OpCode::Increment =\u003e Some(Instruction::Increment), OpCode::Decrement =\u003e Some(Instruction::Decrement), OpCode::Write =\u003e Some(Instruction::Write), OpCode::Read =\u003e Some(Instruction::Read), OpCode::LoopBegin =\u003e { loop_start = i; loop_stack += 1; None }, OpCode::LoopEnd =\u003e panic!(\"LoopStartingError\"), }; match instr { Some(instr) =\u003e program.push(instr), None =\u003e () } } else { match op { // Handling loop conditions OpCode::LoopBegin =\u003e { loop_stack += 1; }, OpCode::LoopEnd =\u003e { loop_stack -= 1; if loop_stack == 0 { program.push(Instruction::Loop(parse(opcodes[loop_start+1..i].to_vec()))); } }, _ =\u003e (), } } } if loop_stack != 0 { panic!(\"LoopEndingError\"); } program } Now, the only piece remaining is the logic that brings the parsed commands into an actual program.\n3Ô∏è‚É£ Interpreter Rather predictably, we would use the output of parser in the form of Vector of Instruction.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 fn interpret(instructions: \u0026Vec\u003cInstruction\u003e, tape: \u0026mut Vec\u003cu8\u003e, data_pointer: \u0026mut usize) { for instr in instructions { match instr { Instruction::IncrementPointer =\u003e *data_pointer += 1, Instruction::DecrementPointer =\u003e *data_pointer -= 1, Instruction::Increment =\u003e tape[*data_pointer] += 1, Instruction::Decrement =\u003e tape[*data_pointer] -= 1, Instruction::Write =\u003e print!(\"{}\", tape[*data_pointer] as char), Instruction::Read =\u003e { let mut input: [u8; 1] = [0]; std::io::stdin().read_exact(\u0026mut input).expect(\"failed to read stdin\"); tape[*data_pointer] = input[0]; }, Instruction::Loop(nested_instructions) =\u003e { while tape[*data_pointer] != 0 { interpret(\u0026nested_instructions, tape, data_pointer) } } } } } ‚≠ê Main 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 fn main() { let args: Vec\u003cString\u003e = env::args().collect(); if args.len() != 2 { println!(\"usage::\\ncargo run \\nbf \"); std::process::exit(1); } let filename = \u0026args[1]; // Read file into String let mut file = File::open(filename).expect(\"FileNotFoundError\"); let mut source = String::new(); file.read_to_string(\u0026mut source).expect(\"ReadFailureError\"); // File -\u003e Lexer let opcodes = lex(source); // Lexer -\u003e Parser let program = parse(opcodes); // Zero initialised 1kb tape let mut tape: Vec\u003cu8\u003e = vec![0; 1024]; let mut data_pointer = 512; interpret(\u0026program, \u0026mut tape, \u0026mut data_pointer); } That‚Äôs how easy it is to make BF interpreter in Rust. Make your own BF programs and share them with me !\n","wordCount":"899","inLanguage":"en","datePublished":"2022-03-21T00:00:00Z","dateModified":"2022-03-21T00:00:00Z","author":{"@type":"Person","name":"Manas Mahale"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://manasmahale.xyz/posts/rust-3/"},"publisher":{"@type":"Organization","name":"Manas Mahale","logo":{"@type":"ImageObject","url":"https://cdn.rcsb.org/images/structures/vx/6vxx/6vxx_assembly-1.jpeg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://manasmahale.xyz accesskey=h title="Manas Mahale (Alt + H)"><img src=https://cdn.rcsb.org/images/structures/vx/6vxx/6vxx_assembly-1.jpeg alt=logo aria-label=logo height=35>Manas Mahale</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://manasmahale.xyz>Home</a>&nbsp;¬ª&nbsp;<a href=https://manasmahale.xyz/posts/>Posts</a></div><h1 class=post-title>ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä</h1><div class=post-meta><span title='2022-03-21 00:00:00 +0000 UTC'>March 21, 2022</span>&nbsp;¬∑&nbsp;5 min&nbsp;¬∑&nbsp;899 words&nbsp;¬∑&nbsp;Manas Mahale</div></header><div class=post-content><h1 id=history>History<a hidden class=anchor aria-hidden=true href=#history>#</a></h1><p>Brainf**k hereafter referred to as BF, is a turing complete, <a href=https://en.wikipedia.org/wiki/Esoteric_programming_language><code>esoteric</code></a> <a href=https://esolangs.org/wiki/Main_Page><code>programming language</code></a> created by Urban M√ºller. For the uninitiated, esoteric languages are programming languages that are designed specifically to be unique, difficult to program in, or be just plain weird.</p><h1 id=crash-course-in-bf>Crash Course in BF<a hidden class=anchor aria-hidden=true href=#crash-course-in-bf>#</a></h1><table><thead><tr><th><em>OpCode</em></th><th><em>Instruction</em></th></tr></thead><tbody><tr><td><code>></code></td><td>Increment the data pointer</td></tr><tr><td><code>&lt;</code></td><td>Decrement the data pointer</td></tr><tr><td><code>[</code></td><td>If the byte at the data pointer is zero, jump instruction pointer forward to the command after the matching <code>]</code> command</td></tr><tr><td><code>]</code></td><td>If the byte at the data pointer is nonzero, move instruction pointer to the command after the matching <code>[</code> command</td></tr><tr><td><code>,</code></td><td>One byte Input at the data pointer</td></tr><tr><td><code>.</code></td><td>Output the byte at the data pointer</td></tr><tr><td><code>+</code></td><td>Increment the byte at the data pointer</td></tr><tr><td><code>-</code></td><td>Decrement the byte at the data pointer</td></tr></tbody></table><p>This is how we can print <code>Hello World!</code> in BF.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-brainfuck data-lang=brainfuck><span class=line><span class=cl><span class=nb>++++++++</span><span class=k>[</span><span class=nv>&gt;</span><span class=nb>++++</span><span class=k>[</span><span class=nv>&gt;</span><span class=nb>++</span><span class=nv>&gt;</span><span class=nb>+++</span><span class=nv>&gt;</span><span class=nb>+++</span><span class=nv>&gt;</span><span class=nb>+</span><span class=nv>&lt;&lt;&lt;&lt;</span><span class=nb>-</span><span class=k>]</span><span class=nv>&gt;</span><span class=nb>+</span><span class=nv>&gt;</span><span class=nb>+</span><span class=nv>&gt;</span><span class=nb>-</span><span class=nv>&gt;&gt;</span><span class=nb>+</span><span class=k>[</span><span class=nv>&lt;</span><span class=k>]</span><span class=nv>&lt;</span><span class=nb>-</span><span class=k>]</span><span class=nv>&gt;&gt;</span><span class=nt>.</span><span class=nv>&gt;</span><span class=nb>---</span><span class=nt>.</span><span class=nb>+++++++</span><span class=nt>..</span><span class=nb>+++</span><span class=nt>.</span><span class=nv>&gt;&gt;</span><span class=nt>.</span><span class=nv>&lt;</span><span class=nb>-</span><span class=nt>.</span><span class=nv>&lt;</span><span class=nt>.</span><span class=nb>+++</span><span class=nt>.</span><span class=nb>------</span><span class=nt>.</span><span class=nb>--------</span><span class=nt>.</span><span class=nv>&gt;&gt;</span><span class=nb>+</span><span class=nt>.</span><span class=nv>&gt;</span><span class=nb>++</span><span class=nt>.</span><span class=c>
</span></span></span></code></pre></td></tr></table></div></div><h1 id=interpreter>Interpreter<a hidden class=anchor aria-hidden=true href=#interpreter>#</a></h1><p>Creating an interpreter for any common programming language is a difficult task but, BF having only 8 commands makes interpreter much easier. We can break down the task of writing a BF interpreter into 3 tasks.</p><p><strong><code>1Ô∏è‚É£ Lexer</code></strong><br><strong><code>2Ô∏è‚É£ Parser</code></strong><br><strong><code>3Ô∏è‚É£ Interpreter</code></strong></p><h1 id=0-imports>0Ô∏è‚É£ Imports<a hidden class=anchor aria-hidden=true href=#0-imports>#</a></h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=p>{</span><span class=n>env</span><span class=p>,</span><span class=w> </span><span class=n>io</span>::<span class=n>Read</span><span class=p>,</span><span class=w> </span><span class=n>fs</span>::<span class=n>File</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Or
</span></span></span><span class=line><span class=cl><span class=c1>// use std::env;
</span></span></span><span class=line><span class=cl><span class=c1>// use std::io::Read;
</span></span></span><span class=line><span class=cl><span class=c1>// use std::fs::File;
</span></span></span></code></pre></td></tr></table></div></div><h1 id=1-lexer>1Ô∏è‚É£ Lexer<a hidden class=anchor aria-hidden=true href=#1-lexer>#</a></h1><p>This is a relatively straightforward task. As we know, there are 8 commands in BF which we can represent as <code>Enum</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Clone, Debug)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>enum</span> <span class=nc>OpCode</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>IncrementPointer</span><span class=p>,</span><span class=w>   </span><span class=c1>// &gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>DecrementPointer</span><span class=p>,</span><span class=w>   </span><span class=c1>// &lt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>Increment</span><span class=p>,</span><span class=w>          </span><span class=c1>// +
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>Decrement</span><span class=p>,</span><span class=w>          </span><span class=c1>// -
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>Write</span><span class=p>,</span><span class=w>              </span><span class=c1>// .
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>Read</span><span class=p>,</span><span class=w>               </span><span class=c1>// ,
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>LoopBegin</span><span class=p>,</span><span class=w>          </span><span class=c1>// [
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>LoopEnd</span><span class=p>,</span><span class=w>            </span><span class=c1>// ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Let‚Äôs write the Lexer as function using the defined <code>OpCode</code>.
Lexer takes in a <code>String</code> and returns a <code>Vector</code> of <code>OpCode</code>. I‚Äôve considered all the characters other than <code>OpCode</code> to be comments for simplicity.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>lex</span><span class=p>(</span><span class=n>source</span>: <span class=nb>String</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>OpCode</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>operations</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>symbol</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>source</span><span class=p>.</span><span class=n>chars</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>op</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>symbol</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;&gt;&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>IncrementPointer</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;&lt;&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>DecrementPointer</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;+&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>Increment</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;-&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>Decrement</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;.&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>Write</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;,&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>Read</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;[&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>LoopBegin</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=sc>&#39;]&#39;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>OpCode</span>::<span class=n>LoopEnd</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Removing Comments.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=k>match</span><span class=w> </span><span class=n>op</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Some</span><span class=p>(</span><span class=n>op</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>operations</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>op</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>None</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>operations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h1 id=2-parser>2Ô∏è‚É£ Parser<a hidden class=anchor aria-hidden=true href=#2-parser>#</a></h1><p>From the table above, we can associate the <code>OpCode</code> with their respective <code>Instruction</code>. We can represent <code>Instruction</code> as <code>Enum</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug, Clone)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>enum</span> <span class=nc>Instruction</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>IncrementPointer</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>DecrementPointer</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Increment</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Decrement</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Write</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Read</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Loop</span><span class=p>(</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Instruction</span><span class=o>&gt;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Parser takes in the <code>Vector</code> of <code>OpCode</code> generated by the lexer and returns <code>Vector</code> of <code>Instruction</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>parse</span><span class=p>(</span><span class=n>opcodes</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>OpCode</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Instruction</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>program</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Instruction</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>loop_stack</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>loop_start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=w> </span><span class=n>op</span><span class=p>)</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>opcodes</span><span class=p>.</span><span class=n>iter</span><span class=p>().</span><span class=n>enumerate</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>loop_stack</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>instr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>op</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>IncrementPointer</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>Instruction</span>::<span class=n>IncrementPointer</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>DecrementPointer</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>Instruction</span>::<span class=n>DecrementPointer</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>Increment</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>Instruction</span>::<span class=n>Increment</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>Decrement</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>Instruction</span>::<span class=n>Decrement</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>Write</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>Instruction</span>::<span class=n>Write</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>Read</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>Instruction</span>::<span class=n>Read</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>LoopBegin</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>loop_start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>loop_stack</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=nb>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>LoopEnd</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=fm>panic!</span><span class=p>(</span><span class=s>&#34;LoopStartingError&#34;</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>match</span><span class=w> </span><span class=n>instr</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nb>Some</span><span class=p>(</span><span class=n>instr</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>program</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>instr</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nb>None</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>match</span><span class=w> </span><span class=n>op</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// Handling loop conditions
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>                </span><span class=n>OpCode</span>::<span class=n>LoopBegin</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>loop_stack</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OpCode</span>::<span class=n>LoopEnd</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>loop_stack</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=n>loop_stack</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>program</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>Instruction</span>::<span class=n>Loop</span><span class=p>(</span><span class=n>parse</span><span class=p>(</span><span class=n>opcodes</span><span class=p>[</span><span class=n>loop_start</span><span class=o>+</span><span class=mi>1</span><span class=o>..</span><span class=n>i</span><span class=p>].</span><span class=n>to_vec</span><span class=p>())));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>loop_stack</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>panic!</span><span class=p>(</span><span class=s>&#34;LoopEndingError&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>program</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Now, the only piece remaining is the logic that brings the parsed commands into an actual program.</p><h1 id=3-interpreter>3Ô∏è‚É£ Interpreter<a hidden class=anchor aria-hidden=true href=#3-interpreter>#</a></h1><p>Rather predictably, we would use the output of parser in the form of <code>Vector</code> of <code>Instruction</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>interpret</span><span class=p>(</span><span class=n>instructions</span>: <span class=kp>&amp;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Instruction</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>tape</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>data_pointer</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=kt>usize</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>instr</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>instructions</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>match</span><span class=w> </span><span class=n>instr</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Instruction</span>::<span class=n>IncrementPointer</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=o>*</span><span class=n>data_pointer</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Instruction</span>::<span class=n>DecrementPointer</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=o>*</span><span class=n>data_pointer</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Instruction</span>::<span class=n>Increment</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>tape</span><span class=p>[</span><span class=o>*</span><span class=n>data_pointer</span><span class=p>]</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Instruction</span>::<span class=n>Decrement</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>tape</span><span class=p>[</span><span class=o>*</span><span class=n>data_pointer</span><span class=p>]</span><span class=w> </span><span class=o>-=</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Instruction</span>::<span class=n>Write</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=fm>print!</span><span class=p>(</span><span class=s>&#34;{}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>tape</span><span class=p>[</span><span class=o>*</span><span class=n>data_pointer</span><span class=p>]</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>char</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Instruction</span>::<span class=n>Read</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>input</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>1</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>std</span>::<span class=n>io</span>::<span class=n>stdin</span><span class=p>().</span><span class=n>read_exact</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>input</span><span class=p>).</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;failed to read stdin&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>tape</span><span class=p>[</span><span class=o>*</span><span class=n>data_pointer</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>input</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>},</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Instruction</span>::<span class=n>Loop</span><span class=p>(</span><span class=n>nested_instructions</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>while</span><span class=w> </span><span class=n>tape</span><span class=p>[</span><span class=o>*</span><span class=n>data_pointer</span><span class=p>]</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>interpret</span><span class=p>(</span><span class=o>&amp;</span><span class=n>nested_instructions</span><span class=p>,</span><span class=w> </span><span class=n>tape</span><span class=p>,</span><span class=w> </span><span class=n>data_pointer</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h1 id=-main>‚≠ê Main<a hidden class=anchor aria-hidden=true href=#-main>#</a></h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>args</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>env</span>::<span class=n>args</span><span class=p>().</span><span class=n>collect</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>args</span><span class=p>.</span><span class=n>len</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;usage::\ncargo run &lt;file.bf&gt;\nbf &lt;file.bf&gt;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>std</span>::<span class=n>process</span>::<span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>filename</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>args</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Read file into String
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>File</span>::<span class=n>open</span><span class=p>(</span><span class=n>filename</span><span class=p>).</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;FileNotFoundError&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>source</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>file</span><span class=p>.</span><span class=n>read_to_string</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>source</span><span class=p>).</span><span class=n>expect</span><span class=p>(</span><span class=s>&#34;ReadFailureError&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// File -&gt; Lexer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>opcodes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lex</span><span class=p>(</span><span class=n>source</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Lexer -&gt; Parser
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>program</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>parse</span><span class=p>(</span><span class=n>opcodes</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Zero initialised 1kb tape
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>tape</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>vec!</span><span class=p>[</span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=mi>1024</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>data_pointer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>512</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>interpret</span><span class=p>(</span><span class=o>&amp;</span><span class=n>program</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>tape</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>data_pointer</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>That‚Äôs how easy it is to make BF interpreter in Rust.
Make your own BF programs and share them with me !</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://manasmahale.xyz/tags/rust/>Rust</a></li><li><a href=https://manasmahale.xyz/tags/brainfk/>Brainf**k</a></li></ul><nav class=paginav><a class=prev href=https://manasmahale.xyz/posts/rust-4/><span class=title>¬´</span><br><span>ü¶Ä RayTracer ‚¶Ç‚¶Ç Operator Overloading ü¶Ä</span></a>
<a class=next href=https://manasmahale.xyz/posts/rust-2/><span class=title>¬ª</span><br><span>ü¶Ä Rust ‚¶Ç‚¶Ç Type System ü¶Ä</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä on twitter" href="https://twitter.com/intent/tweet/?text=%f0%9f%a6%80%20Rust%20%e2%a6%82%e2%a6%82%20Brainf%2a%2ak%20Interpreter%20%f0%9f%a6%80&url=https%3a%2f%2fmanasmahale.xyz%2fposts%2frust-3%2f&hashtags=Rust%2cBrainf%2a%2ak"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share ü¶Ä Rust ‚¶Ç‚¶Ç Brainf**k Interpreter ü¶Ä on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmanasmahale.xyz%2fposts%2frust-3%2f&title=%f0%9f%a6%80%20Rust%20%e2%a6%82%e2%a6%82%20Brainf%2a%2ak%20Interpreter%20%f0%9f%a6%80&summary=%f0%9f%a6%80%20Rust%20%e2%a6%82%e2%a6%82%20Brainf%2a%2ak%20Interpreter%20%f0%9f%a6%80&source=https%3a%2f%2fmanasmahale.xyz%2fposts%2frust-3%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://manasmahale.xyz>Manas Mahale</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>